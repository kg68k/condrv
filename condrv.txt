☆ Console driver (バックログ専用) ☆

        このプログラムは卑弥呼☆氏による「Console driver Type-D for
        X68000 version 1.09c」を改造し、X68030 等のマシンでも動作するよ
        うにしたものです。バックスクロール以外の機能は削除されています。


・機能

コンソール(画面)へ出力した文字をバッファに保存し、後から閲覧したり、取り
込んだデータをキーボードから入力したかに見せかけて入力する事が出来ます。
通信ソフトのバックログとほぼ同じものです。


・condrv.sys と condrvem.sys

キー割り当てによってファイルを二種類用意してあります。
condrv.sys がオリジナルと同じ ED 系、condrvem.sys が EMACS 系です。


・登録方法

CONFIG.SYS 中の device 行で組み込み、直後に hiocs.x を組み込んで下さい。
device 組み込み以外の動作は保証しません。

一部の機能を hiocs.x に依存させているので、hiocs.x を組み込まない、
あるいは逆の順序で組み込んだ場合は正常に動作しません。

なお、一度組み込まれると、以後リセットによる再起動が行われた時はそれまで
のバッファの内容は破棄されずに残り、その続きから取り込みが行われます。
ただし、起動時に SHIFT キーを押しているとバッファの内容を破棄して初期化
します。


・オプション

'-' から始まる引数を指定する事によって、バッファ容量・動作モードなどを設
定できます。-h、-n、-o 以外のオプションは '-b128k16j' のように続けて指定
する事が出来ます。

        -a	ウィンドウを開く時にラスタ割り込みを無効にする。

        -b<n>	<n>KB のバックスクロールバッファを確保する。
                未指定時は組み込みを中止する。
                -b の後に # を記述すれば(-b#<n>)、組み込み時に SHIFT キ
                ーを押していなくても、バッファを常に初期化する。

        -c	バッファへの保存を中断した状態で起動する。

        -f[n]	システムステータスの抑制。
                1～15の数値を指定した場合は、表示色とみなして抑制はしない。

        -h[chr]	ペーストヘッダありの状態で起動する。
                また、文字を指定した場合は > で設定する文字を変更する。

        -j	ペースト時にコード入力 LED が点灯していたら16進数以外の
                文字はペーストしない。

        -k<n>	<n>KB のキーボードバッファを確保する。

        -m[n]	テキスト画面/マウス制御(数値省略時は -m15)。
                        bit3 = 1:コンソールのカーソル制御をしない。
                        bit2 = 1:テキストの使用状況を無視する。
                        bit1 = 1:マウスプレーンを保存する。
                        bit0 = 1:マウス制御をする。

        -n[b][c][e][t]
                バッファへの取り込み時にフィルタリングを行う。
                -n の後に各文字を続けて指定する事が出来る(例:-nbe)
                b : BS 処理。
                c : 制御記号削除。
                e : ESC 削除。
                t : TAB をスペースに置き換える。

        -o<key>	ウィンドウの操作に使用するキーを設定する。
                -o1、-o2、-oc、-os が有効(それぞれ OPT.1、OPT.2、CTRL、
                SHIFT)。未指定時は -o1。
                condrvem.sys ではコンソールからの操作にのみ影響します。

        -p	ペースト時に CTRL キーが離されるまで待つ。

        -r	改行記号を表示する。

        -t	タブを表示する。

        -v	ウィンドウを開く時に垂直同期割り込みを無効にする。

        -w<Yl>[,Yy]
                起動時のウィンドウのサイズを設定する。
                Yl : 行数-1(未指定時28)。
                Yy : 位置(未指定時0)。
                3≦Yl≦28、0≦Yy≦25、Yl+Yy≦28でなければならない。

        -x	検索時に半角アルファベットの大文字小文字を同一視する。


・環境変数 CONDRV.PAL

環境変数 "CONDRV.PAL" にパレットを設定する事で、ウィンドウの文字色・背景
色を変更する事が出来ます。16進数で頭に何も付けずに、文字色・背景色の順に
指定します。

この環境変数を設定していない場合は、それぞれテキストパレット3(白)・0(黒)
のパレットが採用されます。

例)
        set CONDRV.PAL=fffe,0000

・XCON デバイス

condrv(em).sysは raw モードのキャラクタデバイス XCON を持ちます。
XCON デバイスへの出力はバックスクロールバッファへと取り込まれます。
XCON デバイスから入力をする事は出来ません。


・ペースト機能

バックスクロールウィンドウで指定した範囲の文字を IOCS レベルのキー入力バ
ッファに擬似的に出力する事ができます。ただし、一度にペーストできる量は起
動時に確保したキーボードバッファの容量までです。


・キー操作

＜＞の中に書いてあるのが condrv.sys、その左に書いてあるのが condrvem.sys
の操作です。

C-?、S-?、M-?、O-? はそれぞれ CTRL、SHIFT、XF3、OPT.1 との同時押しを表し
ます。XF3 を押すかわりに ESC を事前に押して離しておく二ストローク入力も
可能です。
オプション -o? を指定して組み込むと OPT.1 ではなくCTRL、SHIFT、OPT.2 の
どれかに変更する事が出来ます。


コンソールで有効なキー操作

        O-1 , O-↓ , O-undo
                バックスクロールモードに入ります。カーソルは前回バックス
                クロールモードから抜けた位置になります(その画面がバッフ
                ァ上に残っていない場合は現存する最古の行になります)。

        O-2 , O-↑
                バックスクロールモードに入ります。カーソル位置はバッファ
                の最後になります。

        O-4 , O-help
                カットした領域をキー入力としてペーストします。

        O-bs
                バッファへの取り込みを中断・再開します。

        O-clr
                バッファの内容を初期化します。

        O-→
                ウィンドウ内を一行上にスクロールします。
                バックスクロールウィンドウが表示されている時のみ有効です。

        O-←
                ウィンドウ内を一行下にスクロールします。
                バックスクロールウィンドウが表示されている時のみ有効です。


バックスクロールウィンドウで有効なキー操作

        help , M-?  ＜help , C-j , C-]＞
                キー割り当ての一覧を表示します。
                操作は通常のバックスクロールウィンドウと同じで、終了する
                とカーソルは元の位置に戻ります。

        home , undo , clr , C-x C-c  ＜home , esc , C-[＞
                バックスクロールモードから抜けます。

        C-z , C-undo  ＜O-undo＞
                ウィンドウを表示したまま、バックスクロールモードから抜け
                ます。

        C-bs  ＜C-bs＞
                バッファへの取り込みを中断・再開します。

        C-clr  ＜C-clr＞
                バッファの内容を初期化します。

        C-l
                バックスクロール画面を再描画します。

        C-b , b , ←  ＜C-s , s , ←＞
                カーソルを一文字左に移動します。

        C-f , f , →  ＜C-d , d , →＞
                カーソルを一文字右に移動します。

        C-p , p , ↑  ＜C-e , e , ↑＞
                カーソルを一行上に移動します。

        C-n , n , ↓  ＜C-x , x , ↓＞
                カーソルを一行下に移動します。

        C-a  ＜C-a＞
                カーソルを行の左端に移動します。

        C-e  ＜C-f＞
                カーソルを行の右端に移動します。

        M-b  ＜a＞
                カーソルを一語前に移動します。

        M-f  ＜f＞
                カーソルを一語後に移動します。

        F0  ＜F0 , t＞
                バッファの先頭に移動します。

        F1  ＜F1 , b＞
                バッファの末尾に移動します。

        M-< , C-rolldown
                カーソル位置をマークしてバッファの先頭に移動します。

        M-> , C-rollup
                カーソル位置をマークしてバッファの末尾に移動します。

        M-v , rolldown  ＜rolldown , C-r＞
                前の一画面に移動します。

        C-v , rollup  ＜rollup , C-c＞
                次の一画面に移動します。

        S-t  ＜C-t＞
                表示している画面の一番左上に移動します。

        S-b  ＜C-b＞
                表示している画面の一番右下に移動します。

        C-↑ , C-x C-z  ＜O-↑＞
                ウィンドウの使用行数を減らします。

        C-↓ , C-x z  ＜O-↓＞
                ウィンドウの使用行数を増やします。

        C-← , C-x C-p  ＜C-w , w , O-←＞
                ウィンドウ内を一行下にスクロールします。

        C-→ , C-x C-n  ＜C-z , z , O-→＞
                ウィンドウ内を一行上にスクロールします。

        M-rollup  ＜O-rollup＞
                ウィンドウの表示位置を一行下に移動します。

        M-rolldown  ＜O-rolldown＞
                ウィンドウの表示位置を一行上に移動します。

        C-space , M-space
                カーソル位置をマークします。

        M-C-g
                マーク位置に移動します。

        C-x C-x
                カーソルをマークした位置に移動し、今までカーソルがあった
                位置をマークします(カーソル位置とマーク位置の交換)。

        C-w , del  ＜undo , o , del＞
                カーソル位置とマーク位置の間の文字をキーボードバッファに
                転送し、バックスクロールモードから抜けます。

        M-w
                カーソル位置とマーク位置の間の文字をキーボードバッファに
                転送します。

        C-y  ＜p , C-p , cr , enter＞
                カーソル位置とマーク位置の間の文字をキーボードバッファに
                転送し、バックスクロールモードから抜けて、転送した文字を
                ペーストします。

        cr
                カーソル位置の単語をキーボードバッファに転送し、バックス
                クロールモードから抜けて、転送した文字をペーストします。

        C-k  ＜C-k＞
                カーソル位置から行末までの文字をキーボードバッファに転送
                し、バックスクロールモードから抜けます。

        k  ＜k＞
                カーソル位置から行末までの文字をキーボードバッファに転送
                し、バックスクロールモードから抜けて、転送した文字をペー
                ストします。

        C-u  ＜C-u＞
                文頭からカーソル位置までの文字をキーボードバッファに転送
                します。

        u  ＜u＞
                文頭からカーソル位置までの文字をキーボードバッファに転送
                し、バックスクロールモードから抜けて、転送した文字をペー
                ストします。

        C-s
                前方遂次検索を行います。

        C-r
                後方遂次検索を行います。

        C-x C-s , /  ＜/ , F3＞
                前方検索を行います。

        C-x C-r , ? ＜? , S-F3＞
                後方検索を行います。

        C-^  ＜C-^＞
                前方検索を行いますが、文字列入力時にあらかじめカーソル位
                置の単語がペーストされます。

        C-\  ＜C-\＞
                前方検索を行いますが、文字列入力時にあらかじめカーソル位
                置の単語がペーストされます。

        M-n  ＜n , F4＞
                前方次検索を行います。

        S-n  ＜C-n , S-F4＞
                後方次検索を行います。

        C-x w , C-x C-w  ＜C-@＞
                カーソル位置とマーク位置の間の文字をファイルに書き出しま
                す。

        C-x i , C-x C-i  ＜C-y＞
                バッファの末尾にファイルを読み込みます。

        C-x m  ＜q＞
                condrvem.sysの動作を指定するフラグを変更します。

        C-x C-m  ＜C-q＞
                オプション-mで指定する事が出来るフラグを変更します。

        M-i
                タブの表示/非表示を切り替えます。

        M-*
                改行記号の表示/非表示を切り替えます。

        C-i , tab , > , : , -  ＜C-i , tab , > , : , -＞
                ペースト時の行頭に付加するヘッダ文字を設定します。
                同じ記号を押せば解除できます。

        ＜m＞
                マーク状態を切り替えます。マークをしていない時に押せばカ
                ーソル位置をマークして範囲指定モードに入り、カーソルを移
                動すれば選択中の範囲が反転して表示されます。その後 cr な
                どを押せば選択した範囲がペーストされます。範囲指定中は
                LED も反転します。

        ＜ins＞
                m キーと同じですが、LED が反転しません。

        ＜l＞
                カーソル位置にラベルを付けます。後から '(shift + 7)でラ
                ベル名を指定してその位置に移動できます。

        ＜'＞
                l で登録したラベルの位置に移動します。

        C-x =
                カーソル位置の文字のコード、桁位置、バッファ上のアドレス
                などを表示します。デバッグ用の機能です。同梱のファイルは
                使用できない設定でアセンブルされているかも知れません。


遂次検索で有効なキー操作

        Meta
                検索を終了します。カーソルは現在位置のままです。

        C-g
                検索を終了します。カーソルは検索開始時の位置に戻ります。

        C-s
                現在までに入力した文字列でもう一度前方検索をします。

        C-r
                現在までに入力した文字列でもう一度後方検索をします。

        C-b , bs
                入力した文字を一文字削除します。カーソル位置は変わりませ
                ん。

        C-f
                バッファから検索文字列を一文字取り込みます。
                後方検索でも一応使えます。

        C-v , C-q
                制御記号を入力するモードになります。

        上記以外の制御記号を入力すると、自動的に確定して遂次検索を抜けて
        からそのキーの機能を実行します。


・ファイル入出力時の ~/ 展開

　insert-file(C-x i, C-x C-i)、write-file(C-x w, C-x C-w)で、~/ または
~\ から始まるファイル名を入力した場合、~ は環境変数 HOME の内容に置き換
えられます。

　例えば、環境変数 HOME の内容が c:/home になっている時に ~/foo.txt とい
うファイル名を指定すると、実際には c:/home/foo.txt というファイルに対し
て入出力が行われます。


・注意

　KeyWitch.x と併用する場合は、KeyWitch version 2.13 patchlevel 3 以降を
使用し、KeyWitch のドキュメントに書いてある通り condrv の方を先に組み込
んで下さい。パッチをあてていない KeyWitch との併用は保証しません。
　condrv -> hiocs -> keywitch という順番を推奨します。

　起動キーを OPT.2 系にしていると、MicroEMACS 上でキー入力やペーストが正
常に動作しない恐れがあります。

　マウスプレーンが他のプログラムに占有されている時は、安全の為ウィンドウ
をオープン出来ないようになっています。

　バックログウィンドウをオープン中はテキスト使用モードが 2(アプリケーシ
ョンで使用)に設定され、クローズした時に 1(システムで使用)に変更されます。


・仕様

　オプション -ne 指定時は、XCON への出力でも ESC シーケンスが削除されま
す。

　BG 動作中に行入力を行うと、実行中のプロセスの文字出力が入力行に表示さ
れてしまいます(表示が乱れる以外は特に問題はありません)。

グラフィックマスク(gm)と同時に表示すると、ウィンドウ上だけマスクが外れ
てかっこ悪くなります(テキストプレーンが足りないので仕方ない)。


・著作権、配布条件について

condrvsys.doc より引用した、以下の文章をそのまま継承します。

>このプログラムはフリーウェアです。
>　・どんな障害が起きても責任を負いません。
>　・改造しても構いませんがその場合はオリジナルも添付して下さい。
>　　なお、改造したものについては全く関知いたしません。
>　・今後のサポート等についてはなんら責任を負いません。
>　・非営利目的の転載はかまいませんが、転載時は転載経路をはっきりと
>　　明記して、バージョンアップ等のサポートを必ず行って下さい。

ただし、改造したものを公開する場合はソースファイル若しくはそのテキスト形
式の差分も公開すること。それだけあれば改造版そのものは添付しなくて構いま
せん。

オリジナルの著作権は卑弥呼☆氏が有します。
改造部分の著作権は私、立花@桑島技研が保有します。放棄はしません。

オリジナルの condrv.sys は古いバージョンの書庫に入っています.


TcbnErik / 立花@桑島技研  
https://github.com/kg68k/condrv


[EOF]
